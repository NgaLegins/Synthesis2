<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>7 Days - SVG Vector</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      width: 100vw;
      height: 100vh;
      background-color: black;
      overflow: hidden;
      font-family: Helvetica, Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* Container per le scritte */
    #text-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2; /* Sopra le uova */
      pointer-events: none; /* Lascia passare i click */
    }

    #dynamic-text {
      color: white;
      font-size: 8vmin; /* Dimensione reattiva */
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      text-align: center;
      mix-blend-mode: exclusion; /* Effetto stiloso di fusione (facoltativo) */
    }

    /* Container SVG */
    svg {
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 1;
    }

    /* OVERLAY INIZIALE */
    #overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10;
      cursor: pointer;
      color: white;
      flex-direction: column;
      transition: opacity 0.5s;
      pointer-events: auto;
    }

    h1 {
      font-size: 8vmin;
      margin-bottom: 2vh;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      font-weight: 900;
    }

    p {
      color: #ffd700; 
      font-size: 3vmin;
      font-weight: 700;
      letter-spacing: 0.1em;
      animation: blink 0.8s infinite;
    }

    @keyframes blink {
      0% { opacity: 1; }
      50% { opacity: 0.2; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>

  <div id="text-container">
    <div id="dynamic-text"></div>
  </div>

  <svg xmlns="http://www.w3.org/2000/svg" version="1.1">
    <defs>
      <filter id="goo">
        <feGaussianBlur in="SourceGraphic" stdDeviation="30" result="blur" />
        <feColorMatrix in="blur" mode="matrix" values="
          1 0 0 0 0  
          0 1 0 0 0  
          0 0 1 0 0  
          0 0 0 25 -10" result="goo" />
        <feBlend in="SourceGraphic" in2="goo" />
      </filter>
    </defs>

    <g filter="url(#goo)">
      <circle id="circle1" cx="50%" cy="50%" r="120" fill="#ffcc00" />
      <circle id="circle2" cx="50%" cy="50%" r="120" fill="#ffcc00" />
    </g>
  </svg>

  <div id="overlay">
    <h1>7 Days</h1>
    <p>[ CLICK TO ACTIVE ]</p>
  </div>

  <script>
    const overlay = document.getElementById('overlay');
    let isRunning = false;
    let startTime = 0;

    // Riferimenti agli elementi SVG
    const circle1 = document.getElementById('circle1');
    const circle2 = document.getElementById('circle2');
    const textField = document.getElementById('dynamic-text');

    // SETUP AUDIO
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const masterGain = ctx.createGain();
    masterGain.gain.value = 0.4;
    masterGain.connect(ctx.destination);

    function playSubstanceSound(pitch, duration) {
      if (ctx.state === 'suspended') ctx.resume();
      
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = 'sawtooth'; 
      osc.frequency.setValueAtTime(pitch, ctx.currentTime);
      osc.frequency.exponentialRampToValueAtTime(pitch * 0.2, ctx.currentTime + duration);

      gain.gain.setValueAtTime(0.6, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);

      osc.connect(gain);
      gain.connect(masterGain);
      osc.start();
      osc.stop(ctx.currentTime + duration + 0.1);
    }

    // LOGICA DI ANIMAZIONE
    const holdDuration = 2.0; 
    const moveDuration = 3.0; 
    const totalCycle = holdDuration + moveDuration; 
    let lastState = "initial";

    // Start al click
    overlay.addEventListener('click', () => {
      overlay.style.opacity = 0;
      setTimeout(() => overlay.style.display = 'none', 500);
      
      if (ctx.state === 'suspended') ctx.resume();
      
      isRunning = true;
      startTime = Date.now() / 1000; // Tempo in secondi
      animate();
    });


    function animate() {
      if (!isRunning) return;

      const now = Date.now() / 1000;
      const time = now - startTime;
      const cycleTime = time % totalCycle;

      // 1. GESTIONE STATO E TESTO
      let state = cycleTime < holdDuration ? "united" : "divided";

      if (state !== lastState) {
        if (state === "divided") {
          textField.innerText = "7 DAYS FOR EACH";
          playSubstanceSound(180, 1.5); 
        } else {
          textField.innerText = "REMEMBER, YOU ARE ONE";
          playSubstanceSound(55, 2.0); 
        }
        lastState = state;
      }

      // 2. CALCOLO POSIZIONE
      let offset = 0;
      if (state === "divided") {
        let moveProgress = (cycleTime - holdDuration) / moveDuration;
        // Sinusoide da 0 a 1 e ritorno a 0
        let wave = Math.sin(moveProgress * Math.PI);
        // Distanza massima in pixel (dipende dalla larghezza schermo)
        // Usiamo il 25% della larghezza dello schermo come escursione massima
        const maxDist = window.innerWidth * 0.25; 
        offset = wave * maxDist;
      }

      // 3. AGGIORNAMENTO SVG
      // Il centro è window.innerWidth / 2
      const centerX = window.innerWidth / 2;
      const centerY = window.innerHeight / 2;

      // Aggiorniamo le posizioni
      circle1.setAttribute('cx', centerX - offset);
      circle1.setAttribute('cy', centerY);
      
      circle2.setAttribute('cx', centerX + offset);
      circle2.setAttribute('cy', centerY);

      // Aggiorniamo il raggio in base alla dimensione dello schermo per responsività
      // Raggio = 12% della larghezza minima dello schermo
      const r = Math.min(window.innerWidth, window.innerHeight) * 0.12;
      circle1.setAttribute('r', r);
      circle2.setAttribute('r', r);

      requestAnimationFrame(animate);
    }

    // Gestione ridimensionamento finestra
    window.addEventListener('resize', () => {
      // SVG gestisce il resize nativamente, ma dobbiamo ricalcolare il raggio nel prossimo frame
    });

  </script>
</body>
</html>
